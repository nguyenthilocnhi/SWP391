<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>L·ªãch S·ª≠ D·ªãch V·ª•</title>
  <link rel="stylesheet" href="/Frontend/assets/css/lichsudichvu.css" />
</head>
<body>
  <!-- HEADER -->
  <div id="header-placeholder"></div>
  <script>
    fetch('/Frontend/components/header_customer.html')
      .then(res => res.text())
      .then(html => {
        document.getElementById("header-placeholder").innerHTML = html;
        if (typeof initHeader === 'function') initHeader();
      });
  </script>
  <script src="/Frontend/assets/js/header_customer.js"></script>

  <!-- ALERT -->
  <div id="alert-box" class="alert-box hidden">
    <p id="alert-message">B·∫°n c√≥ th√¥ng b√°o m·ªõi!</p>
    <span id="alert-close">&times;</span>
  </div>

  <!-- MAIN CONTENT -->
  <div class="history-container">
    <h2>L·ªãch S·ª≠ D·ªãch V·ª•</h2>
    <div class="filter-bar">
  <label for="statusFilter">L·ªçc theo tr·∫°ng th√°i:</label>
  <select id="statusFilter">
    <option value="T·∫•t c·∫£">T·∫•t c·∫£</option>
    <option value="Ho√†n_t·∫•t">Ho√†n t·∫•t</option>
    <option value="ƒê√£_h·ªßy">ƒê√£ h·ªßy</option>
    <option value="Ch·ªù_duy·ªát">Ch·ªù duy·ªát</option>
  </select>
</div>

    <table id="historyTable">
      <thead>
        <tr>
          <th>D·ªãch V·ª•</th>
          <th>Ng√†y ƒê·∫∑t</th>
          <th>Ng√†y Th·ª±c Hi·ªán</th>
          <th>Tr·∫°ng Th√°i</th>
          <th>Ghi Ch√∫</th>
          <th>Thao T√°c</th>
        </tr>
      </thead>
      <tbody id="serviceBody">
        <!-- d·ªØ li·ªáu ƒë∆∞·ª£c th√™m qua JS -->
      </tbody>
    </table>
    <!-- H·ªôp ƒê√°nh Gi√° -->
<div id="ratingModal" class="modal hidden">
  <div class="modal-content">
    <h3>ƒê√°nh Gi√° D·ªãch V·ª•</h3>
    <p id="dichVuDangDanhGia"></p>
    <textarea id="reviewText" placeholder="Nh·∫≠p ƒë√°nh gi√° c·ªßa b·∫°n..." rows="4"></textarea>
    <div class="modal-actions">
      <button onclick="luuDanhGia()">G·ª≠i</button>
      <button onclick="dongDanhGia()">H·ªßy</button>
    </div>
  </div>
</div>

  </div>

  <!-- FOOTER -->
  <div id="footer-placeholder"></div>
  <script>
    fetch('/Frontend/components/footer.html')
      .then(res => res.text())
      .then(html => {
        document.getElementById("footer-placeholder").innerHTML = html;
      });
  </script>

  <!-- SCRIPT: HI·ªÇN TH·ªä L·ªäCH S·ª¨ D·ªäCH V·ª§ -->
  <script>

  function renderTable(filteredData = data) {
  const tbody = document.getElementById("serviceBody");
  tbody.innerHTML = "";

  if (filteredData.length === 0) {
    tbody.innerHTML = `<tr><td colspan="6">Kh√¥ng c√≥ d·ªØ li·ªáu ph√π h·ª£p.</td></tr>`;
    return;
  }

  filteredData.forEach((item, index) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${item.ten}</td>
      <td>${item.ngayDat}</td>
      <td>${item.ngayThucHien}</td>
      <td><span class="status ${item.trangThai.toLowerCase()}">${item.trangThai.replace("_", " ")}</span></td>
      <td>${item.ghiChu || ""}</td>
      <td>
        <button onclick="xoa(${index})" class="delete-btn">X√≥a</button>
        ${item.trangThai === "Ho√†n_t·∫•t" ? `<button onclick="moDanhGia('${item.ten}')" class="review-btn">ƒê√°nh gi√°</button>` : ""}
      </td>
    `;
    tbody.appendChild(tr);
  });
}


document.getElementById("statusFilter").addEventListener("change", function () {
  const selected = this.value;
  if (selected === "T·∫•t c·∫£") {
    renderTable(data);
  } else {
    const filtered = data.filter(d => d.trangThai === selected);
    renderTable(filtered);
  }
});


    const data = JSON.parse(localStorage.getItem("lichSuDichVu")) || [];

    function renderTable() {
      const tbody = document.getElementById("serviceBody");
      tbody.innerHTML = "";

      if (data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="6">Kh√¥ng c√≥ d·ªØ li·ªáu l·ªãch s·ª≠.</td></tr>`;
        return;
      }

      data.forEach((item, index) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${item.ten}</td>
          <td>${item.ngayDat}</td>
          <td>${item.ngayThucHien}</td>
          <td><span class="status ${item.trangThai.toLowerCase()}">${item.trangThai}</span></td>
          <td>${item.ghiChu || ""}</td>
          <td><button onclick="xoa(${index})" class="delete-btn">X√≥a</button></td>
        `;
        tbody.appendChild(tr);
      });
    }

    function xoa(index) {
      if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a m·ª•c n√†y?")) {
        data.splice(index, 1);
        localStorage.setItem("lichSuDichVu", JSON.stringify(data));
        renderTable();
      }
    }

    renderTable();


    let tenDichVuDangDanhGia = "";

function moDanhGia(tenDichVu) {
  tenDichVuDangDanhGia = tenDichVu;
  document.getElementById("dichVuDangDanhGia").textContent = `D·ªãch v·ª•: ${tenDichVu}`;
  document.getElementById("reviewText").value = "";
  document.getElementById("ratingModal").classList.remove("hidden");
}

function dongDanhGia() {
  document.getElementById("ratingModal").classList.add("hidden");
}

function luuDanhGia() {
  const review = document.getElementById("reviewText").value.trim();
  if (!review) {
    alert("Vui l√≤ng nh·∫≠p n·ªôi dung ƒë√°nh gi√°!");
    return;
  }

  // L∆∞u v√†o localStorage
  const allReviews = JSON.parse(localStorage.getItem("danhGiaDichVu")) || [];
  allReviews.push({
    tenDichVu: tenDichVuDangDanhGia,
    noiDung: review,
    thoiGian: new Date().toLocaleString()
  });
  localStorage.setItem("danhGiaDichVu", JSON.stringify(allReviews));
  alert("C·∫£m ∆°n b·∫°n ƒë√£ ƒë√°nh gi√°!");
  dongDanhGia();
}

  </script>
  

  <!-- SCRIPT: TH√îNG B√ÅO -->
  <script>
    function showAlert(message) {
      const box = document.getElementById("alert-box");
      const msg = document.getElementById("alert-message");
      msg.textContent = message;
      box.classList.remove("hidden");

      setTimeout(() => box.classList.add("hidden"), 10000);
      document.getElementById("alert-close").onclick = () => box.classList.add("hidden");
    }

    document.addEventListener("DOMContentLoaded", () => {
      setTimeout(() => showAlert("üîî B·∫°n c√≥ 3 th√¥ng b√°o m·ªõi!"), 1000);
    });
  </script>
</body>
</html>
